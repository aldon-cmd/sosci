class VideoConference{constructor(t){this.options={t:{domain:"sosci.tv",i:"conference.sosci.tv"},s:"https://sosci.tv/http-bind",o:"http://jitsi.org/jitsimeet"},this.h={l:!0},this.p=t,this.connection=null,this.u=!1,this.J=null,this.g={m:!1,S:!1},this.v=[],this.$={},this.M=!0,this.k=document.getElementById("btn-toggle-audio"),this._=document.getElementById("btn-toggle-video"),this.k.onclick=(()=>this.C()),this._.onclick=(()=>this.A()),this.j=document.getElementById("btn-share-screen"),this.j.onclick=(()=>this.L()),$(window).bind("beforeunload",this.V),$(window).bind("unload",this.V),this.D=document.getElementById("chat-panel"),this.input=document.getElementById("chat-input"),this.input.addEventListener("keydown",t=>this.F(t)),this.I={O:!0,N:"mbocklcggfhnbahlnepmldehdhpjfcjp",R:!1,T:["screen","window"],U:"0.1",B:!0},JitsiMeetJS.init(this.I),this.connection=new JitsiMeetJS.P(null,null,this.options),this.connection.addEventListener(JitsiMeetJS.q.connection.W,()=>this.G()),this.connection.addEventListener(JitsiMeetJS.q.connection.H,()=>this.K()),this.connection.addEventListener(JitsiMeetJS.q.connection.X,()=>this.disconnect()),JitsiMeetJS.mediaDevices.addEventListener(JitsiMeetJS.q.mediaDevices.Y,()=>this.Z()),this.connection.connect(),JitsiMeetJS.tt({it:["audio","video"]}).then(t=>this.et(t)).catch(t=>{throw t}),JitsiMeetJS.mediaDevices.st("output")&&JitsiMeetJS.mediaDevices.ot(t=>{const i=t.filter(t=>"audiooutput"===t.kind);i.length>1&&($("#audioOutputSelect").nt(i.map(t=>`<option value="${t.ht}">${t.label}</option>`).join("\n")),$("#audioOutputSelectWrapper").show())})}at(){return this.J.ct().find(t=>"audio"===t.lt())}dt(){return this.J.ct().find(t=>"video"===t.lt())}rt(){let t=this.k.getElementsByTagName("i");void 
0!=t&&0!=t.length&&("fas fa-microphone"===t[0].className?t[0].className="fas fa-microphone-slash":t[0].className="fas fa-microphone")}pt(){let t=this._.getElementsByTagName("i");void 0!=t&&0!=t.length&&("fas fa-video"===t[0].className?t[0].className="fas fa-video-slash":t[0].className="fas fa-video")}C(){let t=this.at();t.ut()?t.Jt():t.gt(),this.rt()}A(){let t=this.dt();t.ut()?t.Jt():t.gt(),this.pt()}et(t){this.v=t;for(let t=0;t<this.v.length;t++)this.v[t].addEventListener(JitsiMeetJS.q.track.St,t=>console.log(`Audio Level local: 
${t}`)),this.v[t].addEventListener(JitsiMeetJS.q.track.vt,()=>console.log("local track muted")),this.v[t].addEventListener(JitsiMeetJS.q.track.$t,()=>console.log("local track stoped")),this.v[t].addEventListener(JitsiMeetJS.q.track.Mt,t=>console.log(`track audio output device was changed to ${t}`)),"video"===this.v[t].lt()?($(".video-player-container").append(`<video autoplay='1' id='localVideo${t}' />`),this.v[t].ft($(`#localVideo${t}`)[0])):($(".video-player-container").append(`<audio autoplay='1' muted='true' id='localAudio${t}' />`),this.v[t].ft($(`#localAudio${t}`)[0])),this.u&&this.J.addTrack(this.v[t])}kt(t){if(t._t())return;const i=t.bt();this.$[i]||(this.$[i]=[]);const e=this.$[i].push(t);t.addEventListener(JitsiMeetJS.q.track.St,t=>console.log(`Audio Level remote: ${t}`)),t.addEventListener(JitsiMeetJS.q.track.vt,()=>console.log("remote track muted")),t.addEventListener(JitsiMeetJS.q.track.$t,()=>console.log("remote track stoped")),t.addEventListener(JitsiMeetJS.q.track.Mt,t=>console.log(`track audio output device was changed to ${t}`));const s=i+t.lt()+e;"video"===t.lt()?$("body").append(`<video autoplay='1' id='${i}video${e}' />`):$("body").append(`<audio autoplay='1' id='${i}audio${e}' />`),t.ft($(`#${s}`)[0])}yt(){console.log("conference joined!"),this.u=!0;for(let t=0;t<this.v.length;t++)this.J.addTrack(this.v[t])}Ct(t){if(console.log("user left"),!this.$[t])return;const i=this.$[t];for(let e=0;e<i.length;e++)i[e].detach($(`#${t}${i[e].lt()}`))}G(){this.J=this.connection.wt("conference",this.h),this.J.At(this.p),this.J.jt(JitsiMeetJS.q.Vt.Lt,(t,i,e)=>this.Dt(t,i,e)),this.J.jt(JitsiMeetJS.q.Vt.xt,t=>this.kt(t)),this.J.jt(JitsiMeetJS.q.Vt.Ft,t=>{console.log(`track removed!!!${t}`)}),this.J.jt(JitsiMeetJS.q.Vt.It,()=>this.yt()),this.J.jt(JitsiMeetJS.q.Vt.Ot,t=>{console.log("user join"),this.$[t]=[]}),this.J.jt(JitsiMeetJS.q.Vt.Et,t=>this.Ct(t)),this.J.jt(JitsiMeetJS.q.Vt.vt,t=>{console.log(`${t.lt()} - ${t.ut()}`)}),this.J.jt(JitsiMeetJS.q.Vt.Nt,(t,i)=>console.log(`${t} - ${i}`)),this.J.jt(JitsiMeetJS.q.Vt.St,(t,i)=>console.log(`${t} - ${i}`)),this.J.jt(JitsiMeetJS.q.Vt.Rt,()=>console.log(`${this.J.Tt()} - ${this.J.Ut()}`)),this.J.join(),this.J.Bt(this.g)}Dt(t,i,e){let s=document.createElement("DIV");s.setAttribute("class","live-chat");let o=document.createTextNode(i),n=document.createElement("SPAN");n.appendChild(o);let h='<div class=""><span class="chat-badge"><i class="fas fa-user-circle"></i></span><span class="chat-line-username"><span>'+this.p+"<span>:</span></span></span><span><span>"+n.textContent+"</span></span></div>";s.innerHTML=h,this.D.appendChild(s)}F(t){13==t.keyCode&&(this.J.Pt(this.input.value),this.input.value="")}K(){console.error("Connection Failed!")}Z(t){console.info("current devices",t)}disconnect(){console.log("disconnect!"),this.connection.removeEventListener(JitsiMeetJS.q.connection.W,()=>this.G()),this.connection.removeEventListener(JitsiMeetJS.q.connection.H,()=>this.K()),this.connection.removeEventListener(JitsiMeetJS.q.connection.X,()=>this.disconnect())}V(){for(let t=0;t<this.v.length;t++)this.v[t].Wt();this.J.qt(),this.connection.disconnect()}L(){this.M=!this.M;this.j.getElementsByTagName("i");this.v[1]&&(this.v[1].Wt(),this.v.pop()),JitsiMeetJS.tt({it:[this.M?"video":"desktop"]}).then(t=>{this.v.push(t[0]),this.v[1].addEventListener(JitsiMeetJS.q.track.vt,()=>console.log("local track muted")),this.v[1].addEventListener(JitsiMeetJS.q.track.$t,()=>this.zt()),this.v[1].ft($("#localVideo1")[0]),this.J.addTrack(this.v[1]),this.Gt()}).catch(t=>console.log(t))}Gt(){let t=this.j.getElementsByTagName("i");void 0!=t&&0!=t.length&&(this.M?t[0].className="fas fa-eye":t[0].className="fas fa-eye-slash")}zt(){this.L(),this.Gt()}Ht(t){JitsiMeetJS.mediaDevices.Kt(t.value)}}class ConferenceUI{constructor(){this.Qt=document.getElementById("participants-panel"),this.Xt=document.getElementById("video-controls-panel"),this.D=document.getElementById("chat-panel"),document.getElementById("btn-toggle-participants-panel").onclick=(()=>this.Yt()),document.getElementById("btn-toggle-chat-panel").onclick=(()=>this.Zt()),document.getElementById("btn-toggle-video-controls-panel").onclick=(()=>this.ti())}Yt(){this.Qt.style.cssText="display:block !important",this.Xt.style.cssText="display:none !important",this.D.style.cssText="display:none !important"}Zt(){this.Qt.style.cssText="display:none !important",this.Xt.style.cssText="display:none !important",this.D.style.cssText="display:block !important"}ti(){this.Qt.style.cssText="display:none !important",this.Xt.style.cssText="display:block !important",this.D.style.cssText="display:none !important"}}