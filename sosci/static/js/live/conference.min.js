class VideoConference{constructor(t){this.options={t:{domain:"sosci.tv",i:"conference.sosci.tv"},s:"https://sosci.tv/http-bind",o:"http://jitsi.org/jitsimeet"},this.h={l:!0},this.u=t,this.connection=null,this.p=!1,this.J=null,this.g={m:!1,S:!1},this.v=[],this.M={},this.$=!0,this.k=document.getElementById("btn-toggle-audio"),this._=document.getElementById("btn-toggle-video"),this.k.onclick=()=>this.C(),this._.onclick=()=>this.A(),this.j=document.getElementById("btn-share-screen"),this.j.onclick=()=>this.L(),$(window).bind("beforeunload",this.V),$(window).bind("unload",this.V),this.D=document.getElementById("chat-panel"),this.input=document.getElementById("chat-input"),this.input.addEventListener("keydown",t=>this.F(t)),this.I={O:!0,N:"mbocklcggfhnbahlnepmldehdhpjfcjp",R:!1,T:["screen","window"],U:"0.1",B:!0},JitsiMeetJS.init(this.I),this.connection=new JitsiMeetJS.JitsiConnection(null,null,this.options),this.connection.addEventListener(JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED,()=>this.P()),this.connection.addEventListener(JitsiMeetJS.events.connection.CONNECTION_FAILED,()=>this.W()),this.connection.addEventListener(JitsiMeetJS.events.connection.CONNECTION_DISCONNECTED,()=>this.disconnect()),JitsiMeetJS.mediaDevices.addEventListener(JitsiMeetJS.events.mediaDevices.DEVICE_LIST_CHANGED,()=>this.q()),this.connection.connect(),JitsiMeetJS.createLocalTracks({G:["audio","video"]}).then(t=>this.H(t)).catch(t=>{throw t}),JitsiMeetJS.mediaDevices.isDeviceChangeAvailable("output")&&JitsiMeetJS.mediaDevices.enumerateDevices(t=>{const i=t.filter(t=>"audiooutput"===t.kind);i.length>1&&($("#audioOutputSelect").html(i.map(t=>`<option value="${t.K}">${t.label}</option>`).join("\n")),$("#audioOutputSelectWrapper").show())})}X(){return this.J.Y().find(t=>"audio"===t.Z())}tt(){return this.J.Y().find(t=>"video"===t.Z())}it(){let t=this.k.getElementsByTagName("i");null!=t&&0!=t.length&&("fas fa-microphone"===t[0].className?t[0].className="fas fa-microphone-slash":t[0].className="fas fa-microphone")}et(){let t=this._.getElementsByTagName("i");null!=t&&0!=t.length&&("fas fa-video"===t[0].className?t[0].className="fas fa-video-slash":t[0].className="fas fa-video")}C(){let t=this.X();t.st()?t.ot():t.nt(),this.it()}A(){let t=this.tt();t.st()?t.ot():t.nt(),this.et()}H(t){this.v=t;for(let t=0;t<this.v.length;t++)this.v[t].addEventListener(JitsiMeetJS.events.track.TRACK_AUDIO_LEVEL_CHANGED,t=>console.log("Audio Level local: "+t)),this.v[t].addEventListener(JitsiMeetJS.events.track.TRACK_MUTE_CHANGED,()=>console.log("local track muted")),this.v[t].addEventListener(JitsiMeetJS.events.track.LOCAL_TRACK_STOPPED,()=>console.log("local track stoped")),this.v[t].addEventListener(JitsiMeetJS.events.track.TRACK_AUDIO_OUTPUT_CHANGED,t=>console.log("track audio output device was changed to "+t)),"video"===this.v[t].Z()?($(".video-player-container").append(`<video autoplay='1' id='localVideo${t}' />`),this.v[t].ht($("#localVideo"+t)[0])):($(".video-player-container").append(`<audio autoplay='1' muted='true' id='localAudio${t}' />`),this.v[t].ht($("#localAudio"+t)[0])),this.p&&this.J.addTrack(this.v[t])}at(t){if(t.lt())return;const i=t.ct();this.M[i]||(this.M[i]=[]);const e=this.M[i].push(t);t.addEventListener(JitsiMeetJS.events.track.TRACK_AUDIO_LEVEL_CHANGED,t=>console.log("Audio Level remote: "+t)),t.addEventListener(JitsiMeetJS.events.track.TRACK_MUTE_CHANGED,()=>console.log("remote track muted")),t.addEventListener(JitsiMeetJS.events.track.LOCAL_TRACK_STOPPED,()=>console.log("remote track stoped")),t.addEventListener(JitsiMeetJS.events.track.TRACK_AUDIO_OUTPUT_CHANGED,t=>console.log("track audio output device was changed to "+t));const s=i+t.Z()+e;"video"===t.Z()?$("body").append(`<video autoplay='1' id='${i}video${e}' />`):$("body").append(`<audio autoplay='1' id='${i}audio${e}' />`),t.ht($("#"+s)[0])}dt(){console.log("conference joined!"),this.p=!0;for(let t=0;t<this.v.length;t++)this.J.addTrack(this.v[t])}rt(t){if(console.log("user left"),!this.M[t])return;const i=this.M[t];for(let e=0;e<i.length;e++)i[e].detach($(`#${t}${i[e].Z()}`))}P(){this.J=this.connection.ut("conference",this.h),this.J.pt(this.u),this.J.Jt(JitsiMeetJS.events.conference.MESSAGE_RECEIVED,(t,i,e)=>this.gt(t,i,e)),this.J.Jt(JitsiMeetJS.events.conference.TRACK_ADDED,t=>this.at(t)),this.J.Jt(JitsiMeetJS.events.conference.TRACK_REMOVED,t=>{console.log("track removed!!!"+t)}),this.J.Jt(JitsiMeetJS.events.conference.CONFERENCE_JOINED,()=>this.dt()),this.J.Jt(JitsiMeetJS.events.conference.USER_JOINED,t=>{console.log("user join"),this.M[t]=[]}),this.J.Jt(JitsiMeetJS.events.conference.USER_LEFT,t=>this.rt(t)),this.J.Jt(JitsiMeetJS.events.conference.TRACK_MUTE_CHANGED,t=>{console.log(`${t.Z()} - ${t.st()}`)}),this.J.Jt(JitsiMeetJS.events.conference.DISPLAY_NAME_CHANGED,(t,i)=>console.log(`${t} - ${i}`)),this.J.Jt(JitsiMeetJS.events.conference.TRACK_AUDIO_LEVEL_CHANGED,(t,i)=>console.log(`${t} - ${i}`)),this.J.Jt(JitsiMeetJS.events.conference.PHONE_NUMBER_CHANGED,()=>console.log(`${this.J.St()} - ${this.J.vt()}`)),this.J.join(),this.J.Mt(this.g)}gt(t,i,e){let s=document.createElement("DIV");s.setAttribute("class","live-chat");let o=document.createTextNode(i),n=document.createElement("SPAN");n.appendChild(o);let h='<div class=""><span class="chat-badge"><i class="fas fa-user-circle"></i></span><span class="chat-line-username"><span>'+this.u+"<span>:</span></span></span><span><span>"+n.textContent+"</span></span></div>";s.innerHTML=h,this.D.appendChild(s)}F(t){13==t.keyCode&&(this.J.ft(this.input.value),this.input.value="")}W(){console.error("Connection Failed!")}q(t){console.info("current devices",t)}disconnect(){console.log("disconnect!"),this.connection.removeEventListener(JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED,()=>this.P()),this.connection.removeEventListener(JitsiMeetJS.events.connection.CONNECTION_FAILED,()=>this.W()),this.connection.removeEventListener(JitsiMeetJS.events.connection.CONNECTION_DISCONNECTED,()=>this.disconnect())}V(){for(let t=0;t<this.v.length;t++)this.v[t].$t();this.J.kt(),this.connection.disconnect()}L(){this.$=!this.$;this.j.getElementsByTagName("i");this.v[1]&&(this.v[1].$t(),this.v.pop()),JitsiMeetJS.createLocalTracks({G:[this.$?"video":"desktop"]}).then(t=>{this.v.push(t[0]),this.v[1].addEventListener(JitsiMeetJS.events.track.TRACK_MUTE_CHANGED,()=>console.log("local track muted")),this.v[1].addEventListener(JitsiMeetJS.events.track.LOCAL_TRACK_STOPPED,()=>this._t()),this.v[1].ht($("#localVideo1")[0]),this.J.addTrack(this.v[1]),this.bt()}).catch(t=>console.log(t))}bt(){let t=this.j.getElementsByTagName("i");null!=t&&0!=t.length&&(this.$?t[0].className="fas fa-eye":t[0].className="fas fa-eye-slash")}_t(){this.L(),this.bt()}yt(t){JitsiMeetJS.mediaDevices.setAudioOutputDevice(t.value)}}class ConferenceUI{constructor(){this.Ct=document.getElementById("participants-panel"),this.wt=document.getElementById("video-controls-panel"),this.D=document.getElementById("chat-panel"),document.getElementById("btn-toggle-participants-panel").onclick=()=>this.At(),document.getElementById("btn-toggle-chat-panel").onclick=()=>this.jt(),document.getElementById("btn-toggle-video-controls-panel").onclick=()=>this.Lt()}At(){this.Ct.style.cssText="display:block !important",this.wt.style.cssText="display:none !important",this.D.style.cssText="display:none !important"}jt(){this.Ct.style.cssText="display:none !important",this.wt.style.cssText="display:none !important",this.D.style.cssText="display:block !important"}Lt(){this.Ct.style.cssText="display:none !important",this.wt.style.cssText="display:block !important",this.D.style.cssText="display:none !important"}}
