{% extends "base_plugnpay.html" %} 
{% load static %} 
{% load currency_filters %}
{% load purchase_info_tags %}


{% block content %}
<div id="checkout">
  <div class="container no-padding">
    <div class="row ">

      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 box-container">
        <div class="payment-container">
          <div class="cc-header d-flex">
            <div class="payment-title">Payment Method</div>
            <div class="card-image">
              <img src="{% static 'img/visa.png' %}" />
              <img src="{% static 'img/mastercard.png' %}"/>
            </div>
          </div>
          <div class="text">
            <p class="line-clamp overflow-visible">Fill in all the fields below, and when you're finshed, click the "Confirm & Pay" button to process your Debit or Credit card.</p>
          </div>
        </div>
        <div class="payment-container pay-form-1">
          <div>
            {% purchase_info_for_product request product as session %}
            {% include "payment/partials/plugnpay_form.html" %}
          </div>
        </div>
      </div> 

      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 box-container">
        <div class="payment-container">
          <div class="payment-panel">
            <div class="payment-header">
              <h3>{{product.get_title}}</h3>
            </div>
            <div class="payment-panel-body">
              <div class="subtotal d-flex">
                <div class="subtotal-title col-lg-6 col-md-6 col-sm-6 no-padding">Course subtotal</div>
                <div class="amount col-lg-6 col-md-6 col-sm-6 no-padding">{{ session.price.excl_tax|currency:session.price.currency }}</div>
              </div>
              <div class="subtax d-flex">
                <div class="subtax-title col-lg-6 col-md-6 col-sm-6 no-padding">Applicable Taxes</div>
                <div class="amount col-lg-6 col-md-6 col-sm-6 no-padding">{{ session.price.incl_tax|currency:session.price.currency }}</div>
              </div>
              <div class="due-amount d-flex">
                <div class="total-title col-lg-6 col-md-6 col-sm-6 no-padding">Amount Due</div>
                <div class="amount col-lg-6 col-md-6 col-sm-6 no-padding">{{ session.price.incl_tax|currency:session.price.currency }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 box-container pay-form-2">
        <div>
          {% purchase_info_for_product request product as session %}
          {% include "payment/partials/plugnpay_form.html" %}
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock content %}

{% block extrascripts %}
{{ block.super }}
<script>
   function submit_payment(){
  
  //payment_api.send();

  $('#payment-form').submit();
 }

$(document).ready(function() {

 payment_api.setCallback(function(data) { 
    console.log(data);
   // 'data' is the querystring returned by the payment request.  
   // Perform any response handling you would like to do here.  
   // For example, such as putting the value of data into a field and calling submit on the form.  
   
   });

 });

  $("#btn-submit-payment").click(submit_payment);
</script>
{% endblock extrascripts %} 
